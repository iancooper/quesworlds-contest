# QuestWorlds.Resolution

Contest resolution module for calculating successes and determining winners.

## Overview

This module resolves contests by calculating successes from dice rolls and determining the winner. It is purely deterministic - given the same inputs, it always produces the same output. Randomness is handled by the separate DiceRoller module.

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                   QuestWorlds.Resolution                        │
│                                                                 │
│  Inputs:                                                        │
│    - ContestFrame (from Framing module)                         │
│    - DiceRolls (provided by caller, generated by DiceRoller)    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │        IContestResolver (Role: Success Calculator)       │   │
│  │  - Resolve(ContestFrame, DiceRolls) → ResolutionResult   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Output:                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              ResolutionResult (Immutable)                │   │
│  │  - PlayerRoll, ResistanceRoll                            │   │
│  │  - PlayerSuccesses, ResistanceSuccesses                  │   │
│  │  - Winner (Player/Resistance/Tie)                        │   │
│  │  - Degree (0-3+)                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## Key Types

| Type | Description |
|------|-------------|
| `IContestResolver` | Interface for resolving contests |
| `ContestResolver` | Implementation of contest resolution logic |
| `DiceRolls` | Value object containing player and resistance roll values |
| `ResolutionResult` | Immutable result containing all resolution data |
| `ContestWinner` | Enum indicating who won (Player, Resistance, or Tie) |
| `ServiceCollectionExtensions` | Extension methods for dependency injection |

## QuestWorlds Success Calculation

### Determining Successes

| Roll vs Target Number | Successes |
|----------------------|-----------|
| Roll < TN | 1 success |
| Roll = TN | 2 successes (big success) |
| Roll > TN | 0 successes |
| Each mastery | +1 success |

### Determining Winner

1. The participant with more successes wins
2. If successes are tied, the higher roll wins
3. If both are equal, it's a true tie

### Degree of Victory/Defeat

The degree equals the difference in successes (0, 1, 2, 3+).

## Usage

### With Known Dice Rolls (Deterministic - for testing)

```csharp
var resolver = new ContestResolver();
var rolls = new DiceRolls(PlayerRoll: 5, ResistanceRoll: 12);
var result = resolver.Resolve(frame, rolls);
```

### With Random Dice Rolls (for production)

```csharp
var resolver = new ContestResolver();
var result = resolver.Resolve(frame); // Rolls internally
```

### Typical Orchestration in Web Layer

```csharp
// Generate random rolls
var rolls = _diceRoller.Roll();

// Resolve contest (deterministic)
var result = _contestResolver.Resolve(frame, rolls);

// Interpret outcome
var outcome = _outcomeInterpreter.Interpret(result, frame);
```

## Design Decisions

- **Purely Deterministic**: Given the same inputs, always produces the same output
- **Separation of Concerns**: Randomness handled by DiceRoller module
- **Immutable Results**: `ResolutionResult` cannot be modified after creation
- **Two Overloads**: One for testing with known rolls, one for convenience in production

## Related ADRs

- [ADR-0004: Resolution Module](../../docs/adr/0004-resolution-module.md)
- [ADR-0006: DiceRoller Module](../../docs/adr/0006-diceroller-module.md) - Provides DiceRolls
- [ADR-0003: Framing Module](../../docs/adr/0003-framing-module.md) - Provides ContestFrame input
